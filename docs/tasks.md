# 实现计划: 拾取筛

## 概述

该实现计划将拾取筛模组的设计转换为一系列增量的编码任务。每个任务都建立在前面的任务基础上，最终将所有组件连接在一起。重点关注核心功能的早期验证和测试驱动的开发方法。

## 任务

- [x] 1. 建立项目结构和核心接口
  - 创建Forge模组目录结构
  - 定义主模组类和基本注解
  - 设置构建配置文件(build.gradle)
  - 创建模组信息文件(mcmod.info)
  - _需求: 8.1_

- [x] 2. 实现配置管理系统
  - [x] 2.1 创建ConfigManager类和FilterMode枚举
    - 实现配置文件读写逻辑
    - 定义三种工作模式的枚举
    - 实现默认配置生成
    - _需求: 1.1, 6.1_

  - [x] 2.2 为配置管理编写属性测试
    - **属性 6: 配置持久性往返**
    - **验证需求: 需求 6.2, 6.4, 8.4**

  - [x] 2.3 实现FilterRule类和物品匹配逻辑
    - 创建过滤规则数据结构
    - 实现物品匹配算法
    - 支持通配符和模组ID匹配
    - _需求: 6.3_

  - [x] 2.4 为物品匹配编写属性测试
    - **属性 7: 匹配逻辑一致性**
    - **验证需求: 需求 6.3**

- [x] 3. 实现按键绑定系统
  - [x] 3.1 创建KeyBindingManager类
    - 注册K键作为清除快捷键
    - 实现按键状态检测
    - _需求: 5.1_

  - [x] 3.2 为按键绑定编写单元测试
    - 测试按键注册和检测功能
    - _需求: 5.1_

- [x] 4. 检查点 - 确保基础组件测试通过
  - 已验证 `./gradlew test` 通过（BUILD SUCCESSFUL）

- [x] 5. 实现核心事件处理系统
  - [x] 5.1 创建EventHandler类和物品拾取事件处理
    - 实现EntityItemPickupEvent监听器
    - 根据当前模式处理拾取事件
    - _需求: 3.1, 3.3, 3.4_

  - [x] 5.2 为拾取过滤编写属性测试
    - **属性 3: 拾取模式过滤一致性**
    - **验证需求: 需求 3.3, 3.4**

  - [x] 5.3 实现自动销毁功能
    - 在LivingUpdateEvent中检测玩家周围掉落物
    - 实现匹配掉落物的自动销毁
    - _需求: 2.1, 2.2, 2.3_

  - [x] 5.4 为自动销毁编写属性测试
    - **属性 2: 销毁模式掉落物移除**
    - **验证需求: 需求 2.2, 2.3**

- [x] 6. 实现快捷键清除功能
  - [x] 6.1 实现区域掉落物清除逻辑
    - 计算玩家周围2个区块范围
    - 使用world.getEntitiesWithinAABB查找掉落物
    - 实现批量实体移除
    - _需求: 5.2, 5.3_

  - [x] 6.2 为清除功能编写属性测试
    - **属性 5: 快捷键清除完整性**
    - **验证需求: 需求 5.2, 5.3, 5.4**

  - [x] 6.3 添加用户反馈消息
    - 实现聊天消息显示
    - 添加操作确认提示
    - _需求: 5.4, 7.2_

- [x] 7. 实现模式切换和状态管理
  - [x] 7.1 实现模式切换逻辑
    - 创建模式切换接口
    - 实现状态变更通知
    - 添加模式状态显示
    - _需求: 1.2, 7.1_

  - [x] 7.2 为模式切换编写属性测试
    - **属性 1: 模式切换一致性**
    - **验证需求: 需求 1.2**

  - [x] 7.3 实现关闭模式的透明行为
    - 确保关闭模式下不进行任何拦截
    - 验证原版行为保持不变
    - _需求: 1.3, 4.1, 4.2, 4.3_

  - [x] 7.4 为关闭模式编写属性测试
    - **属性 4: 关闭模式透明性**
    - **验证需求: 需求 1.3, 4.1, 4.2, 4.3**

- [x] 8. 集成和连接所有组件
  - [x] 8.1 在主模组类中连接所有组件
    - 初始化所有管理器
    - 注册事件处理器到Forge事件总线
    - 设置组件间的依赖关系
    - _需求: 8.1, 8.2_

  - [x] 8.2 编写集成测试
    - 测试端到端的功能流程
    - 验证组件间的正确交互
    - _需求: 8.1, 8.2_

- [x] 9. 添加用户界面和配置功能
  - [x] 9.1 实现基本的配置界面
    - 客户端按键打开配置界面（默认 `P`）
    - 实现过滤规则的添加/删除，并可同步到服务端配置
    - _需求: 6.1_

  - [x] 9.2 为配置界面编写单元测试
    - 用纯 Java 的编辑器模型覆盖“添加/去重/删除/选择”等核心交互
    - _需求: 6.1_

  - [x] 9.3 添加首次使用说明
    - 首次进入世界自动展示说明界面，并提供“打开配置”入口
    - _需求: 7.4_

- [x] 10. 最终检查点 - 确保所有测试通过
  - 运行完整的测试套件
  - 验证所有功能正常工作
  - 已验证 `./gradlew test --no-daemon` 与 `./gradlew build --no-daemon` 通过（BUILD SUCCESSFUL）

## 注意事项

- 所有任务都是必需的，确保从一开始就全面覆盖
- 每个任务都引用特定需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况
